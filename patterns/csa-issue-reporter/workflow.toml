[workflow]
name = "csa-issue-reporter"
description = "File structured GitHub issues when CSA encounters errors during operation"

[[workflow.variables]]
name = "ISSUE_BODY"

[[workflow.variables]]
name = "ISSUE_TITLE"

[[workflow.variables]]
name = "ISSUE_URL"

[[workflow.steps]]
id = 1
title = "Gather Environment Context"
tool = "bash"
prompt = """
Collect version and system information for the issue report.

```bash
csa --version 2>&1 || echo "csa not found"
uname -srm
rustc --version 2>/dev/null || echo "rustc not available"
git -C "$(git rev-parse --show-toplevel)" log -1 --format="%h %s" 2>/dev/null
```"""
on_fail = "abort"

[[workflow.steps]]
id = 2
title = "Determine Labels"
prompt = """
Map error type to GitHub labels:
- Quota / rate limit → bug, provider-quota
- Crash / panic → bug, crash
- Parse failure → bug, parsing
- Session state → bug, session
- Tool not found → bug, configuration
- Unexpected behavior → bug

If labels do not exist, fall back to just "bug"."""
on_fail = "abort"

[[workflow.steps]]
id = 3
title = "Create Issue"
tool = "bash"
prompt = '''
Create the GitHub issue with structured template using gh CLI.
Title follows Conventional Commits: type(scope): error_summary.

```bash
gh issue create \
  --repo RyderFreeman4Logos/cli-sub-agent \
  --title "${ISSUE_TITLE}" \
  --label "bug" \
  --body "${ISSUE_BODY}"
```'''
on_fail = "abort"

[[workflow.steps]]
id = 4
title = "Report Back"
prompt = """
Return the issue URL to the caller.

```bash
echo "Issue filed: ${ISSUE_URL}"
```"""
on_fail = "abort"
